<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Eleview V1.4.5</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<style>
html, body { min-height:100%; margin:0; padding:0; font-family:"Inter","Noto Sans KR",sans-serif; color:#fff; overflow-x:hidden; } 
#particle-wrap { position:fixed; inset:0; width:100%; height:100%; z-index:0; pointer-events:none; } 
.app { position:relative; z-index:2; max-width:480px; margin:0 auto; padding:16px; display:flex; flex-direction:column; gap:12px; min-height:100vh; } header{text-align:center; margin-top:5vh; position:relative;} 
.logo{font-size:20px; font-weight:700; color:#fff; padding:10px 14px; border-radius:12px; background:rgba(255,255,255,0.05); box-shadow:0 0 20px rgba(155,92,255,0.25);} 
.subtitle{text-align:center; color:rgba(255,255,255,0.75); font-size:13px;} 
#visitorCount{font-size:12px; color:#ccc; margin-top:4px;} 
.search{display:flex; flex-direction:column; gap:8px;} 
.box{width:96.5%; background:rgba(105, 100, 100, 0.281); border-radius:10px; padding:6px 8px; display:flex; align-items:center; backdrop-filter:blur(6px);} 
input[type=text]{flex:1; background:transparent; border:none; outline:none; color:#fff; font-size:14px; padding:6px;} 
#result-list {display: flex; flex-direction: column; gap: 16px; padding-bottom: 40px;}
#customModal, #historyModal{display:none; position:fixed; inset:0; justify-content:center; align-items:center; z-index:10;} 
#customModal{background:rgba(0,0,0,0.7);} 
#customContent, #historyContentBox{background:rgb(0, 0, 0); padding:20px; border-radius:12px; display:flex; flex-direction:column; gap:10px;} 
#customContent label{font-size:13px;} 
#customContent input, #customContent button{margin-top:5px;} 
#historyContentBox{max-width:400px; width:100%; color:#fff; max-height:70vh; overflow:auto;} 
.footer{text-align:center; color:rgba(255,255,255,0.5); font-size:11px; margin:20px 0;}
#searchBtn {background: linear-gradient(135deg, #9b5cff 0%, #6e22ff 100%); border: none; color: #fff; font-size: 16px; font-weight: 600; padding: 14px; border-radius: 16px; cursor: pointer; box-shadow: 0 6px 16px rgba(155,92,255,0.5); transition: transform 0.15s ease, box-shadow 0.15s ease; }
#searchBtn:hover {transform: translateY(-2px); box-shadow: 0 10px 20px rgba(155,92,255,0.6);}
#searchBtn:active {transform: translateY(1px); box-shadow: 0 4px 10px rgba(155,92,255,0.4);background: linear-gradient(135deg, #8a3fff 0%, #5c00e0 100%);}
.card{background:rgba(255,255,255,0.06); border-radius:12px; padding:12px; box-shadow:0 4px 16px rgba(0,0,0,0.4); backdrop-filter:blur(10px);}
.card h3 {font-size: 18px; margin-bottom: 8px; color: #fff; text-shadow: 0 2px 6px rgba(0,0,0,0.5);}
.card .meta { font-size: 12px; color: rgba(255,255,255,0.7); margin-bottom: 12px;}
.card .info strong {color: #9e9e9e; }
.card .btn {margin-top: 12px; background: linear-gradient(180deg,#d67cff 0%,#9b5cff 100%); border-radius: 14px; padding: 10px; font-weight: 600; box-shadow: 0 4px 12px rgba(214,124,255,0.5); transition: transform 0.1s;}
.card .btn:hover {transform: scale(1.05);}
.card .view-history-btn {position: absolute; top: 12px; right: 20px; background: linear-gradient(180deg,#d67cff 0%,#9b5cff 100%); border: none; color: #fff; border-radius: 12px; padding: 6px 10px; font-size: 12px; font-weight: 600; cursor: pointer; box-shadow: 0 4px 10px rgba(214,124,255,0.5); transition: transform 0.1s;}
.card .view-history-btn:hover {transform: scale(1.05);}
/* ì»¤ìŠ¤í…€ ëª¨ë‹¬ ë²„íŠ¼ */
#customContent .btn {
  background: linear-gradient(135deg, #6e22ff 0%, #9b5cff 100%);
  color: #fff;
  border: none;
  border-radius: 12px;
  padding: 10px 14px;
  font-weight: 600;
  font-size: 14px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(155,92,255,0.5);
  transition: transform 0.15s ease, box-shadow 0.15s ease;
  width: 100%;
  text-align: center;
}

/* í˜¸ë²„ íš¨ê³¼ */
#customContent .btn:hover {
  transform: translateY(-2px) scale(1.03);
  box-shadow: 0 8px 20px rgba(155,92,255,0.6);
}

/* í´ë¦­ íš¨ê³¼ */
#customContent .btn:active {
  transform: translateY(1px);
  box-shadow: 0 3px 10px rgba(155,92,255,0.4);
  background: linear-gradient(135deg, #5c00e0 0%, #8a3fff 100%);
}

/* ëª¨ë‹¬ ë‚´ë¶€ ì‘ì€ ë²„íŠ¼ (ì˜ˆ: ìƒ‰ìƒ ì„ íƒ, íŒŒì¼ ì²¨ë¶€ ë“±) */
#customContent input[type="file"], 
#customContent input[type="color"] {
  border-radius: 10px;
  padding: 6px;
  border: 1px solid rgba(155,92,255,0.5);
  background: rgba(50,20,80,0.4);
  color: #fff;
  font-size: 13px;
  outline: none;
}

#customContent input[type="file"]::file-selector-button {
  background: linear-gradient(135deg, #9b5cff 0%, #6e22ff 100%);
  color: #fff;
  border: none;
  padding: 6px 10px;
  border-radius: 10px;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  transition: transform 0.15s ease, box-shadow 0.15s ease;
}
#customContent input[type="file"]::file-selector-button:hover {
  transform: translateY(-1px) scale(1.02);
  box-shadow: 0 4px 12px rgba(155,92,255,0.5);
}
#favModal > div {
  background: linear-gradient(135deg, #332200, #554400);
  box-shadow: 0 10px 30px rgba(255,215,0,0.6), 0 0 12px rgba(255,215,0,0.25) inset;
}
.fav-item {
  padding: 12px 16px;
  background: rgba(255,215,0,0.1);
  border-radius: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  box-shadow: 0 4px 12px rgba(255,215,0,0.25);
  color: #fff8e1;
  font-weight: 500;
}
.fav-item:hover {
  transform: scale(1.05);
  background: rgba(255,215,0,0.25);
  box-shadow: 0 6px 18px rgba(255,215,0,0.5);
}

#trafficModal > div {
  background: linear-gradient(145deg, #1a002e, #3a0060);
  box-shadow: 0 10px 24px rgba(0,255,255,0.5), 0 0 10px rgba(0,255,255,0.25) inset;
  color: #fff;
}
#trafficContent {
  font-size: 14px;
  line-height: 1.6;
  text-align: center;
}
#donateModal > div {
  background: linear-gradient(135deg, #2e0000, #44001a);
  box-shadow: 0 10px 28px rgba(255,107,107,0.5), 0 0 12px rgba(255,107,107,0.25) inset;
}
#donateModal p {
  margin: 6px 0;
  line-height: 1.4;
  color: #ffdddd;
}
#donateModal strong {
  color: #ffd700;
  text-shadow: 0 0 6px #ffd700aa, 0 0 12px #ffb70066;
}
</style>
</head>
<body style="background:#000000;">

<canvas id="particle-wrap"></canvas>

<div class="app">
<header style="display:flex; justify-content:center; align-items:center; position:relative; margin-top:5vh;">
  <div class="logo">Eleview V1.4.5</div>

  <!-- í–„ë²„ê±° ë²„íŠ¼ -->
  <button id="menuBtn" style="position:absolute; right:10px; top:50%; transform:translateY(-50%);
        background:none; border:none; color:#fff; font-size:24px; cursor:pointer;">â˜°</button>

  <!-- í–„ë²„ê±° ë©”ë‰´ íŒ¨ë„ -->
  <div id="menuPanel" style="display:none; position:absolute; top:60px; right:10px; 
      background:rgba(0,0,0,0.85); border-radius:12px; padding:10px; flex-direction:column; gap:8px; min-width:160px; z-index:5;">
 <a href="https://open.kakao.com/o/sYLH7W1h" target="_blank"
   style="display:block; width:100%; padding:6px 0; font-weight:600; border-radius:8px; text-align:center; cursor:pointer; text-decoration:none; border:2px solid #d67cff; color:#d67cff; background:none; margin-bottom:8px;">
   ğŸ“© ë¬¸ì˜
</a>

<button id="customBtnMenu"
   style="display:block; width:100%; padding:6px 0; font-weight:600; border-radius:8px; text-align:center; cursor:pointer; border:2px solid #d67cff; color:#d67cff; background:none; margin-bottom:8px;">
   âš™ï¸ ì„¤ì •
</button>

<button id="viewTrafficBtn"
   style="display:block; width:100%; padding:6px 0; font-weight:600; border-radius:8px; text-align:center; cursor:pointer; border:2px solid #00fff2; color:#00ffff; background:none; margin-bottom:8px;">
   ğŸ“Š íŠ¸ë˜í”½ ì¡°íšŒ
</button>

<a href="https://naver.me/GcKVxHTB" target="_blank"
   style="display:block; width:100%; padding:6px 0; font-weight:600; border-radius:8px; text-align:center; cursor:pointer; text-decoration:none; border:2px solid #00c73c; color:#00c73c; background:none; margin-bottom:8px;">
   ğŸ  ì¹´í˜ ë°”ë¡œê°€ê¸°
</a>

<button id="viewFavsBtn"
   style="display:block; width:100%; padding:6px 0; font-weight:600; border-radius:8px; text-align:center; cursor:pointer; border:2px solid #ffd700; color:#ffd700; background:none; margin-bottom:8px;">
   â­ ì¦ê²¨ì°¾ê¸° ë³´ê¸°
</button>

<button id="donateBtn"
   style="display:block; width:100%; padding:6px 0; font-weight:600; border-radius:8px; text-align:center; cursor:pointer; border:2px solid #ff6b6b; color:#ff6b6b; background:none; margin-bottom:8px;">
   ğŸ’– í›„ì›
</button>

  </div>
</header>

<div id="favModal" style="display:none; position:fixed; inset:0; justify-content:center; align-items:center; z-index:10; background:rgba(0,0,0,0.7);">
  <div style="background:#111; padding:20px; border-radius:12px; max-width:400px; width:90%; max-height:70vh; overflow:auto; display:flex; flex-direction:column; gap:10px;">
    <button id="closeFavModal" class="btn" style="align-self:flex-end;">ë‹«ê¸°</button>
    <h3>ì¦ê²¨ì°¾ê¸° ëª©ë¡</h3>
    <div id="favList"></div>
  </div>
</div>

<div id="trafficModal" style="display:none; position:fixed; inset:0; justify-content:center; align-items:center; z-index:10; background:rgba(0,0,0,0.7);">
  <div style="background:#111; padding:20px; border-radius:12px; max-width:400px; width:90%; display:flex; flex-direction:column; gap:10px;">
    <button id="closeTrafficModal" class="btn" style="align-self:flex-end;">ë‹«ê¸°</button>
    <h3>ì‹¤ì‹œê°„ íŠ¸ë˜í”½</h3>
    <div id="trafficContent" style="font-size:14px; line-height:1.6;"></div>
  </div>
</div>

<button class="btn fav-btn" 
  data-elevator='${elevatorNo}' 
  style="position:absolute; bottom:12px; right:12px; background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">â˜†</button>

<div class="subtitle">
  ìŠ¹ê°•ê¸° ì •ë³´ ì¡°íšŒ
  <div id="visitorCount">ì ‘ì†ì: 0ëª…</div>
</div>

<div class="search">
  <div class="box"><input id="elevatorNo" type="text" placeholder="ìŠ¹ê°•ê¸° ë²ˆí˜¸ ì…ë ¥"></div>
  <div class="box"><input id="buldAddress" type="text" placeholder="ê±´ë¬¼ì£¼ì†Œ ì…ë ¥"></div>
  <button class="btn" id="searchBtn">ê²€ìƒ‰</button>
</div>

<div id="result-list"></div>


<div id="customModal">
  <div id="customContent">
    <h3>ì»¤ìŠ¤í„°ë§ˆì´ì§•</h3>
    <label>ë°°ê²½ ì´ë¯¸ì§€ ì„ íƒ: <input type="file" id="bgImage" accept="image/*"></label>
    <label>ë°°ê²½ ìƒ‰ìƒ (ì´ë¯¸ì§€ ì—†ì„ ë•Œ): <input type="color" id="bgColor" value="#1a002e"></label>
    <label>íŒŒí‹°í´ ìƒ‰ìƒ: <input type="color" id="particleColor" value="#9b5cff"></label>
    <label>íŒŒí‹°í´ ìˆ˜ëŸ‰: <input type="number" id="particleCount" value="80" min="10" max="300"></label>
    <label>ê²€ìƒ‰ ë²„íŠ¼ í…ìŠ¤íŠ¸: <input type="text" id="searchText" value="ê²€ìƒ‰"></label>
    <label>ê²€ìƒ‰ ë²„íŠ¼ ìƒ‰ìƒ: <input type="color" id="searchColor" value="#9b5cff"></label>
    <button class="btn" id="applyBtn">ì ìš©</button>
    <button class="btn" id="closeModal">ë‹«ê¸°</button>
  </div>
</div>

<div id="historyModal">
  <div id="historyContentBox">
    <button id="closeHistoryBtn" class="btn" style="align-self:flex-end; margin-bottom:10px;">ë‹«ê¸°</button>
    <h3>ê²€ì‚¬ì´ë ¥</h3>
    <div id="historyContent"></div>
  </div>
</div>

<div id="donateModal" style="display:none; position:fixed; inset:0; justify-content:center; align-items:center; z-index:10; background:rgba(0,0,0,0.7);">
  <div style="background:#111; padding:20px; border-radius:12px; max-width:400px; width:90%; display:flex; flex-direction:column; gap:10px; text-align:center; color:#fff;">
    <button id="closeDonateModal" class="btn" style="align-self:flex-end;">ë‹«ê¸°</button>
    <h3>í›„ì› ì•ˆë‚´</h3>
    <p>ì—¬ëŸ¬ë¶„ì˜ í›„ì›ì€ ì„œë¹„ìŠ¤ ìœ ì§€ì— í° í˜ì´ ë©ë‹ˆë‹¤! ğŸ’–</p>
    <p><strong>ì€í–‰:</strong>ì¼€ì´ë±…í¬ 888004288696</p>
  </div>
</div>

<div class="footer" style="display:flex; flex-direction:column; align-items:center; gap:6px;">
  @2025 Eleview V1.4.5 - ì œì‘ì : ë§ˆë…€
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // ==== Firebase ë™ì ‘ì ====
  const firebaseConfig = {
    apiKey: "AIzaSyApdyHj-1DiEsOG7XZ6zmDLIEwtLJZ70Js",
    authDomain: "elev-5374e.firebaseapp.com",
    databaseURL: "https://elev-5374e-default-rtdb.firebaseio.com",
    projectId: "elev-5374e",
    storageBucket: "elev-5374e.firebasestorage.app",
    messagingSenderId: "265381396625",
    appId: "1:265381396625:web:5a3db379ef4a038ee43f30",
    measurementId: "G-6XPKDKFE9V"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const visitorRef = db.ref('visitors');
  const visitorId = Date.now() + '_' + Math.floor(Math.random() * 1000);
  function updateVisitor(){ visitorRef.child(visitorId).set({ lastActive: Date.now() }); }
  updateVisitor(); setInterval(updateVisitor, 5000);
  visitorRef.on('value', snapshot => {
    const now = Date.now();
    let count = 0;
    snapshot.forEach(child => { if(now - child.val().lastActive < 15000) count++; });
    document.getElementById('visitorCount').textContent = `ì ‘ì†ì: ${count}ëª…`;
  });

  // ==== í–„ë²„ê±° ë©”ë‰´ ====
  const menuBtn = document.getElementById('menuBtn');
  const menuPanel = document.getElementById('menuPanel');
  const customBtnMenu = document.getElementById('customBtnMenu');
  menuBtn.addEventListener('click', ()=>{ menuPanel.style.display = menuPanel.style.display === 'flex' ? 'none' : 'flex'; });
  customBtnMenu.addEventListener('click', ()=>{ document.getElementById('customModal').style.display='flex'; menuPanel.style.display='none'; });
  window.addEventListener('click', (e)=>{ if(!menuPanel.contains(e.target) && e.target!==menuBtn) menuPanel.style.display='none'; });

  // ==== ê²€ìƒ‰ & API & ê²°ê³¼ ====
  const inputNo=document.getElementById('elevatorNo');
  const inputAddr=document.getElementById('buldAddress');
  const btn=document.getElementById('searchBtn');
  const list=document.getElementById('result-list');
  const favModal = document.getElementById('favModal');
  const favList = document.getElementById('favList');
  const searchBtn = document.getElementById('searchBtn'); // ê²€ìƒ‰ ë²„íŠ¼
  const viewFavsBtn = document.getElementById('viewFavsBtn'); // ëª¨ë‹¬ ì—´ê¸° ë²„íŠ¼
  const closeFavBtn = document.getElementById('closeFavBtn'); // ëª¨ë‹¬ ë‹«ê¸° ë²„íŠ¼
  const serviceKey='6a8c61a1b9e03198dc42d9460e8bf434e703bc3d0989512930046a21a68e1432';
  const API_OPERATION='https://apis.data.go.kr/B553664/ElevatorOperationService/getOperationInfoListV1';
  const API_VIEW='https://apis.data.go.kr/B553664/ElevatorInformationService/getElevatorViewM';
  const API_HISTORY='https://apis.data.go.kr/B553664/ElevatorInformationService/getElvtrInspctInqireM';
  function getElevatorIcon(type){
    if(!type) return ['https://img.icons8.com/ios-filled/50/ffffff/help.png'];
    type=type.trim(); let icons=[];
    if(type.includes('ìŠ¹ê°')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/elevator.png');
    if(type.includes('ì „ë§')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/mountain.png');
    if(type.includes('ë³‘ì›')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/hospital.png');
    if(type.includes('ì¥ì• ì¸')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/wheelchair.png');
    if(type.includes('ì†Œë°©êµ¬ì¡°')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/fire-truck.png');
    if(type.includes('í”¼ë‚œ')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/exit.png');
    if(type.includes('ì£¼íƒ')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/home.png');
    if(type.includes('í™”ë¬¼')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/package.png');
    if(type.includes('ìë™ì°¨')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/car.png');
    if(type.includes('ì†Œí˜•í™”ë¬¼')) icons.push('https://img.icons8.com/ios-filled/50/ffffff/small-package.png');
    return icons.length?icons:['https://img.icons8.com/ios-filled/50/ffffff/help.png'];
  }

  // íŠ¸ë˜í”½ ë°ì´í„° ì°¸ì¡°
const trafficRef = db.ref('traffic');

  btn.addEventListener('click', async ()=>{
    const query=inputNo.value.trim();
    if(!query && !inputAddr.value.trim()){ list.innerHTML='<p>ìŠ¹ê°•ê¸° ë²ˆí˜¸ ë˜ëŠ” ê±´ë¬¼ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.</p>'; return; }
     // ê²€ìƒ‰ ì „ì— íŠ¸ë˜í”½ ì¦ê°€
  trafficRef.transaction(current => {
    if(current){
      if(!current.used) current.used = 0;
      current.used++;
    }
    return current;
  });
    const params=new URLSearchParams({ serviceKey, pageNo:'1', numOfRows:'20' });
    if(query) params.append('elevator_no', query);
    if(inputAddr.value.trim()) params.append('buld_address', inputAddr.value.trim());
    list.innerHTML='';
    try{
      const res=await fetch(`${API_OPERATION}?${params}`);
      const xmlText=await res.text();
      const xml=new DOMParser().parseFromString(xmlText,"text/xml");
      const items=Array.from(xml.getElementsByTagName("item"));
      if(items.length===0){ list.innerHTML='<p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>'; return; }
      for(const item of items){
        const get=(t)=>item.getElementsByTagName(t)[0]?.textContent||'';
        const elevatorNo=get("elevatorNo");
        const kind=get("elvtrKindNm");
        const icons=getElevatorIcon(kind);
        const viewUrl=`${API_VIEW}?serviceKey=${serviceKey}&elevator_no=${elevatorNo}`;
        const viewRes=await fetch(viewUrl);
        const viewXml=await viewRes.text();
        const viewDoc=new DOMParser().parseFromString(viewXml,"text/xml");
        const viewItem=viewDoc.getElementsByTagName("item")[0];
        const v=(t)=>viewItem?.getElementsByTagName(t)[0]?.textContent||'';
        const historyUrl=`${API_HISTORY}?serviceKey=${serviceKey}&elevator_no=${elevatorNo}`;
        const hisRes=await fetch(historyUrl);
        const hisXml=await hisRes.text();
        const hisDoc=new DOMParser().parseFromString(hisXml,"text/xml");
        const historyItems=Array.from(hisDoc.getElementsByTagName("item"));
        console.log('hisXml:', hisXml);
        const shuttleFloor=get("shuttleFloorCnt")||v("shuttleFloorCnt")||'N/A';
        const speed=get("ratedSpeed")||v("ratedSpeed");
        const speedMMin=speed?(parseFloat(speed)*60).toFixed(1):'N/A';
        const liveLoad=get("liveLoad")||v("liveLoad");
        const liveLoadDisplay=liveLoad?`${liveLoad} kg`:'N/A';
        const div=document.createElement('div');
        div.className='card';
        div.innerHTML=`
          <h3>${get("buldNm")||v("buldNm")}</h3>
          <div class='meta'>${elevatorNo} â€¢ ${get("elvtrDiv")}</div>
          <div class='info'>
          <strong>ëª¨ë¸ëª…:</strong> ${get("elvtrModel")}<br>
          <strong>ì œì¡°ì—…ì²´/ë³´ìˆ˜ì—…ì²´:</strong> ${get("mnfcturCpnyNm")} / ${get("companyNm")}<br>
          <strong>ì£¼ì†Œ1/2:</strong> ${get("address1")} / ${get("address2")}<br>
          <strong>ì‹œë„/ì‹œêµ°êµ¬:</strong> ${get("sido")} / ${get("sigungu")}<br>
          <strong>ìŠ¹ê°•ê¸°í˜¸ê¸°:</strong> ${get("elvtrAsignNo")}<br>
          <strong>ìŠ¹ê°•ê¸°í˜•ì‹/ì„¸ë¶€í˜•ì‹:</strong> ${get("elvtrForm")} / ${get("elvtrDetailForm")}<br>
          <strong>ìŠ¹ê°•ê¸°ì¢…ë¥˜:</strong> ${kind}<br>
          <strong>ì„¤ì¹˜ì¼ì:</strong> ìµœì´ˆ: ${get("frstInstallationDe")} / ìµœê·¼: ${get("installationDe")}<br>
          <strong>ì„¤ì¹˜ì¥ì†Œ:</strong> ${get("installationPlace")}<br>
          <strong>ìš´í–‰ì¸µìˆ˜:</strong> ${shuttleFloor}ì¸µ<br>
          <strong>ì •ê²©ì†ë„:</strong> ${speedMMin} m/min<br>
          <strong>ì ì¬í•˜ì¤‘:</strong> ${liveLoadDisplay}<br>
          <strong>ìµœëŒ€ì •ì›:</strong> ${get("ratedCap")}<br>
          <strong>ìœ íš¨ê¸°ê°„:</strong> ${get("applcBeDt")} ~ ${get("applcEnDt")}<br>
          <strong>ê´€ë¦¬ê¸°ê´€:</strong> ${get("inspctInsttNm")}<br>
          <strong>ìŠ¹ê°•ê¸°ìƒíƒœ:</strong> ${get("elvtrSttsNm")}<br>
          <button class="btn fav-btn" data-elevator='${elevatorNo}' style="position:absolute; bottom:12px; right:12px; background:none; border:none; color:#fff; font-size:20px; cursor:pointer;">â˜†</button>
          <button class="btn view-history-btn" data-history='${encodeURIComponent(JSON.stringify(historyItems.map(h=>{
        const hget=(t)=>h.getElementsByTagName(t)[0]?.textContent||'';
        return { inspctDt:hget("inspctDt"), inspctInsttNm:hget("inspctInsttNm"), inspctKind:hget("inspctKind"), psexamYn:hget("psexamYn") };
          })))}'>ğŸ“Œ ê²€ì‚¬ì´ë ¥ ë³´ê¸°</button>
          </div>`;
        list.appendChild(div);
        // âœ… ì¹´ë“œ ìƒì„± í›„ ë°”ë¡œ ì¦ê²¨ì°¾ê¸° ìƒíƒœ ì ìš©
        const favBtn = div.querySelector('.fav-btn');
        const favs = getFavorites();
        if(favs.includes(elevatorNo)) favBtn.textContent = 'â˜…';
               }
    }catch(e){ list.innerHTML=`<p>ì˜¤ë¥˜: ${e.message}</p>`; }
  });

  // ==== ê²€ì‚¬ì´ë ¥ ëª¨ë‹¬ ====
  document.addEventListener('click', e=>{
    if(e.target.classList.contains('view-history-btn')){
        const data=JSON.parse(decodeURIComponent(e.target.dataset.history));
        const content=document.getElementById('historyContent');
        content.innerHTML = data.map(h=>{ 
        const exam=h.psexamYn;
        let bgColor='rgba(255,255,255,0.05)';
        if(exam.includes('ë¶ˆí•©ê²©')) bgColor='rgba(255,0,0,0.4)';
        else if(exam.includes('ì¡°ê±´ë¶€í•©ê²©')) bgColor='rgba(255,255,0,0.4)';
        else if(exam.includes('í•©ê²©')) bgColor='rgba(0,255,0,0.3)';
        else if(exam.includes('ë³´ì™„') || exam.includes('ì°¨ê¸°ì•ˆì „ê²€ì‚¬')) bgColor='rgba(255,165,0,0.4)';
        return `<div style="margin:4px 0; padding:6px; background:${bgColor}; border-radius:6px;">
          <strong>ê²€ì‚¬ì¼ì:</strong> ${h.inspctDt}<br>
          <strong>ê²€ì‚¬ê¸°ê´€:</strong> ${h.inspctInsttNm}<br>
          <strong>ê²€ì‚¬ì¢…ë¥˜:</strong> ${h.inspctKind}<br>
          <strong>í•©ê²©ì—¬ë¶€:</strong> ${h.psexamYn}
        </div>`;
      }).join('');
        document.getElementById('historyModal').style.display='flex';
    }
})
  document.getElementById('closeHistoryBtn').addEventListener('click', ()=>{ document.getElementById('historyModal').style.display='none'; });

// ê²€ìƒ‰ ë²„íŠ¼ í´ë¦­ ì‹œ
btn.addEventListener('click', async () => {
  const query = inputNo.value.trim();

  // íŠ¸ë˜í”½ ì—…ë°ì´íŠ¸
  trafficRef.transaction(current => {
    if (current === null) return { limit: 10000, used: 1 }; // ì´ˆê¸°í™”
    if (current.used < current.limit) {
      current.used + 1;
    }
    return current;
  }).then(result => {
    const data = result.snapshot.val();
    console.log('íŠ¸ë˜í”½ ìƒíƒœ:', data);
  });

  // ê¸°ì¡´ ê²€ìƒ‰ ì½”ë“œ ì‹¤í–‰
});

// í–„ë²„ê±° ë©”ë‰´ â†’ íŠ¸ë˜í”½ ì¡°íšŒ ë²„íŠ¼
const viewTrafficBtn = document.getElementById('viewTrafficBtn');
const trafficModal = document.getElementById('trafficModal');
const trafficContent = document.getElementById('trafficContent');
const closeTrafficModal = document.getElementById('closeTrafficModal');

viewTrafficBtn.addEventListener('click', () => {
  trafficRef.once('value').then(snapshot => {
    const data = snapshot.val() || { limit: 10000, used: 0 };
    const remaining = data.limit - data.used;

    trafficContent.innerHTML = `
      <p>ì‚¬ìš©ëŸ‰: ${data.used}íšŒ</p>
    `;

    trafficModal.style.display = 'flex';
  });
});

closeTrafficModal.addEventListener('click', () => {
  trafficModal.style.display = 'none';
});

// í•˜ë£¨ í•œ ë²ˆ íŠ¸ë˜í”½ ì´ˆê¸°í™”
function resetDailyTraffic() {
  const today = new Date().toISOString().slice(0, 10); // YYYY-MM-DD
  const savedDate = localStorage.getItem("trafficDate");

  if (savedDate !== today) {
    localStorage.setItem("trafficCount", "0"); // íŠ¸ë˜í”½ ì´ˆê¸°í™”
    localStorage.setItem("trafficDate", today); // ì˜¤ëŠ˜ ë‚ ì§œ ì €ì¥
  }
}

// ëª¨ë‹¬ ë‹«ê¸°
document.getElementById('closeTrafficModal').addEventListener('click', () => {
  document.getElementById('trafficModal').style.display = 'none';
});

  // ==== íŒŒí‹°í´ ====
  const c=document.getElementById('particle-wrap'); const ctx=c.getContext('2d'); let w,h;
  function resize(){ w=c.width=innerWidth; h=c.height=innerHeight; } addEventListener('resize',resize); resize();
  let p=[]; function initParticles(count=80,color='#9b5cff'){ p.length=0; for(let i=0;i<count;i++) p.push({x:Math.random()*w,y:Math.random()*h,vx:(Math.random()-0.5)*0.3,vy:(Math.random()-0.5)*0.3,s:Math.random()*2+1,color:color}); }
  function draw(){ ctx.clearRect(0,0,w,h); for(const a of p){ a.x+=a.vx; a.y+=a.vy; if(a.x<0)a.x=w;if(a.x>w)a.x=0;if(a.y<0)a.y=h;if(a.y>h)a.y=0; const g=ctx.createRadialGradient(a.x,a.y,0,a.x,a.y,10); g.addColorStop(0,a.color); g.addColorStop(1,'transparent'); ctx.fillStyle=g; ctx.beginPath(); ctx.arc(a.x,a.y,a.s,0,Math.PI*2); ctx.fill(); } requestAnimationFrame(draw);}
  draw();

  // ==== ì»¤ìŠ¤í„°ë§ˆì´ì§• ëª¨ë‹¬ ====
  const customModal=document.getElementById('customModal');
  const closeModal=document.getElementById('closeModal');
  const applyBtn=document.getElementById('applyBtn');
  const bgImageInput=document.getElementById('bgImage');
  const bgColorInput=document.getElementById('bgColor');
  const particleColorInput=document.getElementById('particleColor');
  const particleCountInput=document.getElementById('particleCount');
  const searchTextInput=document.getElementById('searchText');
  const searchColorInput=document.getElementById('searchColor');

  closeModal.addEventListener('click', ()=>customModal.style.display='none');

  window.addEventListener('load', ()=>{
    const bgColor=localStorage.getItem('bgColor');
    const particleColor=localStorage.getItem('particleColor');
    const particleCount=localStorage.getItem('particleCount');
    const searchText=localStorage.getItem('searchText');
    const searchColor=localStorage.getItem('searchColor');
    const bgImage=localStorage.getItem('bgImage');
    if(bgImage) document.body.style.background=`url(${bgImage}) center/cover no-repeat`;
    else if(bgColor) document.body.style.background=bgColor;
    initParticles(particleCount?parseInt(particleCount):80, particleColor||'#9b5cff');
    if(searchText) btn.textContent=searchText;
    if(searchColor) btn.style.background=`linear-gradient(180deg, ${searchColor} 0%, ${searchColor} 100%)`;
  });

// í›„ì› ëª¨ë‹¬
const donateBtn = document.getElementById('donateBtn');
const donateModal = document.getElementById('donateModal');
const closeDonateModal = document.getElementById('closeDonateModal');

donateBtn.addEventListener('click', () => {
  donateModal.style.display = 'flex';
});

closeDonateModal.addEventListener('click', () => {
  donateModal.style.display = 'none';
});

// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
window.addEventListener('click', (e) => {
  if(e.target === donateModal) donateModal.style.display = 'none';
});

  applyBtn.addEventListener('click', ()=>{
    const file=bgImageInput.files[0];
    const color=bgColorInput.value;
    if(file){
      const reader=new FileReader();
      reader.onload=function(e){
        document.body.style.background=`url(${e.target.result}) center/cover no-repeat`;
        localStorage.setItem('bgImage', e.target.result);
      };
      reader.readAsDataURL(file);
      localStorage.setItem('bgColor', color);
    }else{
      document.body.style.background=color;
      localStorage.setItem('bgColor', color);
      localStorage.removeItem('bgImage');
    }
    const pCount=parseInt(particleCountInput.value);
    const pColor=particleColorInput.value;
    initParticles(pCount,pColor);
    localStorage.setItem('particleCount',pCount);
    localStorage.setItem('particleColor',pColor);
    const sText=searchTextInput.value;
    const sColor=searchColorInput.value;
    btn.textContent=sText;
    btn.style.background=`linear-gradient(180deg, ${sColor} 0%, ${sColor} 100%)`;
    localStorage.setItem('searchText',sText);
    localStorage.setItem('searchColor',sColor);
    customModal.style.display='none';
  });

// ================================
// ì¦ê²¨ì°¾ê¸° ê´€ë ¨ í•¨ìˆ˜
// ================================

document.addEventListener('DOMContentLoaded', () => {
  const viewFavsBtn = document.getElementById('viewFavsBtn');
  const favModal = document.getElementById('favModal');
  const closeFavModal = document.getElementById('closeFavModal');
  const favList = document.getElementById('favList');

  // ================================
  // ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
  // ================================
  viewFavsBtn.addEventListener('click', () => {
    favModal.style.display = 'flex';
    renderFavorites();
  });

  closeFavModal.addEventListener('click', () => {
    favModal.style.display = 'none';
  });

  // ================================
  // ì¹´ë“œ ì¦ê²¨ì°¾ê¸° ë²„íŠ¼ / ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ ë‚´ ì‚­ì œ / ê²€ìƒ‰ í´ë¦­
  // ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹
  // ================================
  document.addEventListener('click', e => {
    // ì¹´ë“œ ë³„í‘œ í´ë¦­
    if (e.target.classList.contains('fav-btn')) {
      const card = e.target.closest('.card');
      if (!card) return;

      const elevatorNo = e.target.dataset.elevator;
      const buldNm = card.querySelector('h3')?.textContent || '';
      
      let favs = getFavorites();
      const index = favs.findIndex(f => f.elevatorNo === elevatorNo);
      
      if (index === -1) {
        favs.push({ elevatorNo, buldNm });
      } else {
        favs.splice(index, 1);
      }
      saveFavorites(favs);
      renderFavorites();
      updateCardStars();
    }
  })})

    // ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ ë‚´ ì‚­ì œ ë²„íŠ¼
    if (e.target.classList.contains('remove-fav-btn')) {
      e.stopPropagation();
      const parent = e.target.closest('.fav-item');
      const elevatorNo = parent.dataset.elevator;
      let favs = getFavorites();
      favs = favs.filter(f => f.elevatorNo !== elevatorNo);
      saveFavorites(favs);
      renderFavorites();
      updateCardStars();
    }

    // ì¦ê²¨ì°¾ê¸° í´ë¦­ -> ê²€ìƒ‰
  favList.querySelectorAll('.fav-name').forEach(el=>{
    el.addEventListener('click',()=>{
      const parent = el.closest('.fav-item');
      const elevatorNo = parent.dataset.elevator;
      if(elevatorNo){
        inputNo.value = elevatorNo;
        favModal.style.display='none';
        searchBtn.click();
      
    }
  });

  // ì´ˆê¸° ë¡œë“œ ì‹œ ì¹´ë“œ ë³„í‘œ ìƒíƒœ ì ìš©
  updateCardStars();
});

// ================================
// ì¦ê²¨ì°¾ê¸° ê°€ì ¸ì˜¤ê¸° / ì €ì¥
// ================================
function getFavorites() {
  return JSON.parse(localStorage.getItem('favorites') || '[]');
}

function saveFavorites(favs) {
  localStorage.setItem('favorites', JSON.stringify(favs));
}

// ================================
// ì¦ê²¨ì°¾ê¸° ë Œë”ë§
// ================================
function renderFavorites(){
  const favs = getFavorites().filter(f=>f.elevatorNo||f.buldNm);

  if(favs.length===0){
    favList.innerHTML='<p>ì¦ê²¨ì°¾ê¸° ì—†ìŒ</p>';
    return;
  }

  favList.innerHTML = favs.map(f=>{
    let text = f.buldNm||'';
    if(f.buldNm && f.elevatorNo) text+=` (${f.elevatorNo})`;
    else if(!f.buldNm && f.elevatorNo) text=f.elevatorNo;

    return `<div class="fav-item" data-elevator="${f.elevatorNo}">
      <span class="fav-name"><strong>${text}</strong></span>
      <button class="remove-fav-btn">ì‚­ì œ</button>
    </div>`;
  }).join('');

  // ì¦ê²¨ì°¾ê¸° í´ë¦­ -> ê²€ìƒ‰
  favList.querySelectorAll('.fav-name').forEach(el=>{
    el.addEventListener('click',()=>{
      const parent = el.closest('.fav-item');
      const elevatorNo = parent.dataset.elevator;
      if(elevatorNo){
        inputNo.value = elevatorNo;
        favModal.style.display='none';
        searchBtn.click();
      }
    });
  });

  // ì‚­ì œ ë²„íŠ¼
  favList.querySelectorAll('.remove-fav-btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      e.stopPropagation();
      const parent = btn.closest('.fav-item');
      const elevatorNo = parent.dataset.elevator;
      let favs = getFavorites();
      favs = favs.filter(f=>f.elevatorNo!==elevatorNo);
      saveFavorites(favs);
      renderFavorites();
      updateCardStars();
    });
  });
}

// ================================
// ì¹´ë“œ ë³„í‘œ ìƒíƒœ ì—…ë°ì´íŠ¸
// ================================
function updateCardStars(){
  const favs = getFavorites();
  document.querySelectorAll('.card .fav-btn').forEach(btn=>{
    const elNo = btn.dataset.elevator;
    btn.textContent = favs.find(f=>f.elevatorNo===elNo)?'â˜…':'â˜†';
  });
}

// ================================
// ì¦ê²¨ì°¾ê¸° ëª¨ë‹¬ ì—´ê¸°/ë‹«ê¸°
// ================================
viewFavsBtn.addEventListener('click', ()=>{
  renderFavorites();
  favModal.style.display='flex';
});
closeFavModal.addEventListener('click', ()=>{ favModal.style.display='none'; });

// ================================
// ì´ˆê¸° ë¡œë“œ
// ================================
updateCardStars();

// ================================
// ì¹´ë“œ ë³„í‘œ ìƒíƒœ ì—…ë°ì´íŠ¸
// ================================
function updateCardStars() {
  const favs = getFavorites();
  document.querySelectorAll('.fav-btn').forEach(btn => {
    const elNo = btn.dataset.elevator;
    if (favs.find(f => f.elevatorNo === elNo)) {
      btn.textContent = 'â˜…'; // ì¦ê²¨ì°¾ê¸° ìˆìŒ
    } else {
      btn.textContent = 'â˜†'; // ì¦ê²¨ì°¾ê¸° ì—†ìŒ
    }
  });
}


// ëª¨ë‹¬ ë°”ê¹¥ í´ë¦­ ì‹œ ë‹«ê¸°
window.addEventListener('click', (e) => {
  if(e.target === donateModal) donateModal.style.display = 'none';
});
</script>
</body>
</html>